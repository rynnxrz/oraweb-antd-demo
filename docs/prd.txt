Ora Internal Process & Client Insight Board – PRD v8
Ora 内部流程与客户洞察看板 – PRD v8（含最新 Part 1 更新）

0. Product Overview / 产品概览
Product Name
Ora Internal Process & Client Insight Board
Ora 内部流程与客户洞察总览

Audience / 主要使用人群

Factory Owner 工厂老板（Wang）

Operations Manager 运营经理

Finance 财务

Production Planner 生产排程

Overall Goal / 整体目标

Move from “we only see raw data” to “we see where time is lost, where processes break, and where opportunities lie.”
从「只能看到原始数据」升级为「一眼看出时间损耗、流程断点和客户机会」。

1. Shared Data & Global Filters / 共用数据与全局筛选
1.1 Core Tables / 核心数据表（基于 s_ora schema）
开发需确保以下字段可用（这里是逻辑字段，不是完整 DDL）：

Contracts / 合同 – t_contracts

contract_id

contract_number

brand（品牌 / 客户维度）

signing_date（签约日期）

deposit_date，deposit_payment_status

pre_prod_payment_date，pre_prod_payment_status

final_payment_date，final_payment_status

status（new / in_progress / completed …）

estimated_production_completion_date（预计生产完成日期）

db_create_tms, db_update_tms

Products / 产品 – t_products

product_id

product_name

total_quantity（可作为体量代理）

production_schedule_date（简化字段，或通过关系表取得）

actual_quantity_produced

shipping_date

actual_quantity_shipped

db_create_tms, db_update_tms

Relationships / 关系表

t_contract_product_relationships：合同 ↔ 产品

t_product_raw_material_relationships：产品 ↔ 原料

t_product_packaging_relationships：产品 ↔ 包材

t_production_line_category_production_line_relationships：产线 ↔ 产线类别

Materials & Packaging / 原料与包材

t_raw_materials.raw_material_arrival_date

t_raw_materials.raw_material_arrival_status

t_packagings.packaging_arrival_date

t_packagings.packaging_arrival_status

Production / 生产排程 – t_production_schedules

production_schedule_start_date

production_schedule_end_date

daily_scheduled_production_quantity（如有）

实际实现可通过 Materialized Views 或后端 Aggregation 计算出合同级别的阶段时间。

1.2 Global Filters / 全局筛选（顶部统一）
顶部统一筛选栏，改变时触发所有 Widget 重新查询：

签约日期范围 (Signing Date Range)

Demo 示例：2024-09-01 ~ 2024-11-30

未来支持「最近 90 天」等滚动选项。

Brand 品牌（单选 / 多选）

Line Category 产线类型

Gummies / Powder / Liquids / Capsules 等

Contract Status 合同状态

Completed only（仅已完成，用于 Part 2 交付周期分析）

All（全部状态，用于 Part 1 异常 & Part 3 客户分析）

Footer 规范（所有 Widget 统一）

每个 Widget 底部必须显示类似文案：

基于 X 份有效记录 · Y 份因 XXX 缺失未纳入统计
Based on X valid records · Y excluded (missing …)

1.3 Stage Definitions / 阶段定义（合同维度）
用于 Part 1 / Part 2 的所有阶段相关分析。

Stage 0 – Contract Entry / 合同录入

Start: signing_date

End: contract_entry_date = date(t_contracts.db_create_tms)

Duration: entry_lag_days = contract_entry_date - signing_date

Stage 1 – Money Ready / 资金到位

Start: contract_entry_date 或 signing_date（由工厂决定一条规则）

End: money_ready_date，逻辑建议：

pre_prod_payment_date 优先；若空，则 deposit_date

Duration: stage1_days = money_ready_date - stage1_start

Stage 2 – Materials Ready / 物料齐套

Start: money_ready_date

End: materials_ready_date，取合同下所有产品的「原料 + 包材」到货日期的最大值

Duration: stage2_days = materials_ready_date - money_ready_date

Stage 3 – Waiting for Production Slot / 等待排产

Start: materials_ready_date

End: production_start_date，取合同关联所有 production_schedule_start_date 的最小值

Duration: stage3_days = production_start_date - materials_ready_date

Stage 4 – Actual Production / 实际生产

v1（无详细生产日报时）：

Start: production_start_date

End: production_end_date = max(production_schedule_end_date)

Duration: stage4_days = production_end_date - production_start_date

Stage 5 – Shipping / 发货

Start: production_end_date

End: shipping_date（合同下所有产品发货日期的最大值）

Duration: stage5_days = shipping_date - production_end_date

Total Lead Time 总周期

total_lead_time_days = shipping_date - signing_date

2. PART 1 – Internal Exception Radar / 内部异常雷达（v8 精简合并版）
目标：用尽量少的组件，让老板一眼看到：
哪几类问题最多 → 哪些订单最严重 → 哪些订单/库存已经“烂在那儿” → 数据是否可靠。

2.1 Widget P1-A – Exception Summary Bar / 全局异常摘要条
Question

“现在有多少订单在不同环节出问题？”

指标定义（与 v7 一致）

后台为每个合同计算布尔标记：

has_leadtime_breach

任一 Stage 耗时 > 对应 stage_k_sla_days

has_payment_block

(pre_prod_payment_status = 'pending' 或 final_payment_status = 'pending')

且 当前日期 - 应付节点日期 > payment_grace_days

has_material_block

production_start_date IS NULL

且 有任一原料 / 包材 arrival_status != 'completed'

且 距离 estimated_production_completion_date < materials_buffer_days

has_data_issue

触发 2.4 数据质量规则（见下）。

KPI 卡片

4 张卡片展示数量（示例文案）：

整体周期超出内部目标

Lead-time Breach

统计条件：has_leadtime_breach = true

收款环节有阻塞

Payment Blocked

条件：has_payment_block = true

物料准备存在风险

Material Risk

条件：has_material_block = true

数据记录需补充

Data Issues

条件：has_data_issue = true

交互逻辑（重要更新）

点击任意卡片 → 视为一个「过滤器」，影响：

P1-B 关键订单阶段总览

P1-D 数据质量 widget

具体规则：

点击「整体周期超出」

P1-B 仅显示 has_leadtime_breach = true 的订单

点击「收款阻塞」

P1-B 仅显示 block_reason = 'money' 的订单

点击「物料风险」

P1-B 仅显示 block_reason = 'materials' 的订单

点击「数据记录需补充」

自动滚动到 P1-D，并展示所有有问题的记录

再次点击同一卡片 → 取消该过滤，恢复为「全部关键订单」。

2.2 Widget P1-B – Key Contracts Stage Overview / 关键订单阶段总览
（合并原 P1-B 严重超时 + P1-C Blockers 的 Graph 部分）

此 widget 内部有两个视图：列表 / 图表，共用数据与筛选。

2.2.1 数据范围：关键订单 Key Contracts
一份合同被视为关键订单，若满足任意条件：

任一阶段 stage_k_delay > 0：

stage_k_delay = max(stage_k_days - stage_k_sla_days, 0)

当前处于“待解决事项”状态（Blocker）：

基于原 Blocker 逻辑：

款项未到：关键款项仍为 pending，且超过 money_block_threshold_days

物料未齐：临近生产但原料/包材未齐，且距离预计生产不足 materials_risk_buffer_days

长时间未更新：today - db_update_tms > silent_threshold_days

为每个关键订单计算：

max_stage_delay：所有阶段延迟天数中的最大值

current_stage：当前所处阶段

is_blocker：当前是否 Blocker

block_reason ∈ {money, materials, silent, null}

days_since_signing：today - signing_date

days_since_last_update：today - db_update_tms

排序规则

is_blocker = true 的订单排在前面

其余按 max_stage_delay 从大到小

仅选 Top N（推荐 20 条，可配置）

所有筛选（来自 KPI 卡片、内部筛选）都在这个集合上做。

2.2.2 列表视图 / List View
问题

「哪些订单最严重？慢在哪些阶段？现在被什么卡住？」

表格列

每行一份合同，建议列：

合同号 (contract_number)

品牌 / 产线 (brand / line_category)

当前阶段 (current_stage)

最严重阶段 (worst_stage)

最严重阶段延迟天数 (worst_stage_delay)

显示为红色标签，如 +15 天

状态 / 原因标签：

待解决事项 – 款项未到

待解决事项 – 物料未齐

待解决事项 – 长时间未更新

仅超出内部目标（只有时间超，但目前不是 Blocker）

签约至今：days_since_signing，如 签约已 45 天

距离上次更新：days_since_last_update，如 18 天未更新

列表顶部筛选（本 widget 内部）

状态筛选（单选）：

全部关键订单

只看待解决事项（is_blocker = true）

只看严重超时（max_stage_delay >= threshold，如 7 天）

原因筛选（多选 Tag）：

款项未到（money）

物料未齐（materials）

长时间未更新（silent）

注意：来自 KPI 卡片的过滤（例如 “Payment Blocked”）等价于自动勾选对应原因。

固定说明文字（表格下方）

「列表按严重程度排序，优先显示待解决事项，其次按超出天数从高到低。当前仅展示前 20 份最需要关注的订单（示例数据）。」

2.2.3 图表视图 / Stage Timeline Matrix
问题

「同一批关键订单，在不同阶段的时间用得怎样？哪些阶段最容易变成问题？」

坐标轴

纵轴（Y）：关键订单

第一行：合同号

第二行（小字）：品牌 / 产线

横轴（X）：阶段名称（固定 5 列）

| 阶段 1 · 款项 | 阶段 2 · 物料 | 阶段 3 · 等待排产 | 阶段 4 · 生产 | 阶段 5 · 发货 |

格子内容（完全可见，不依赖 hover）

每个格子分两行文本：

第一行：延迟情况阶段时间

若 stage_k_delay > 0：

显示 +X 天，背景用红 / 橙色（见颜色规则）

若该阶段已完成且未超出目标：

显示 OK，绿色背景

若尚未进入该阶段 / 无数据：

背景浅灰，不显示文字

第二行：原因 / 状态

若 is_blocker = true 且这个阶段是 Blocker 对应阶段：

款项未到 / 物料未齐 / 长时间未更新（视 block_reason 而定）

若只是一般延迟（非 Blocker），可显示：已超出目标

若完全正常：可留空

颜色规则

红色底：该阶段延迟 + 属于 Blocker 主要阶段（例如：款项未到，对应阶段 1）

橙色底：有延迟，但不是当前 Blocker 阶段

绿色底：按时 / 提前完成（显示 OK）

浅灰底：尚未进入该阶段或数据缺失

可以使用纯 CSS / 简单格子布局实现，不必使用复杂图表库。

固定说明文字（图表下方）

「每一行代表一份关键订单，从左到右依次是阶段 1–5。彩色格子表示该阶段比内部目标多用的天数，并注明当前延迟产生的原因（如：款项未到、物料未齐、长时间未更新）。仅展示延迟最严重的前 20 份订单（示例数据）。」

2.3 Widget P1-C – Zombie Contracts & Stuck Inventory
僵尸合同与滞留库存（结构与 v7 一致，仅小文案调整）

Question

「哪些合同/库存已经很久没人动了？」

Tabs

停滞中的合同（Zombie Contracts）

滞留的库存（Stuck Inventory）

合同视图

条件：

status != 'completed'

today - db_update_tms > contract_zombie_days（如 45 天）

指标：

inactive_days = today - db_update_tms

展示：

横向条形图（X 轴：inactive_days，Y 轴：合同号）

条形越长，表示该合同越久没有任何更新

Tooltip 可补充合同号 / 品牌 / inactive_days（但关键信息也可以直接显示在轴或标签上）

库存视图

条件：

actual_quantity_produced > actual_quantity_shipped

today - planned_shipping_date > inventory_stuck_days（如 7 天）

指标：

days_overdue = today - planned_shipping_date

stuck_qty = produced - shipped

展示：

横向条形图（X 轴：days_overdue，Y 轴：合同或批次）

条形越长，表示这批库存发货逾期越久

Tooltip 或小字可显示 滞留数量。

说明文字

「条形越长，表示该合同/库存越久没有动作。仅展示逾期时间最长的前若干条（示例数据）。」

2.4 Widget P1-D – Data Quality Monitor / 数据记录完整度（更新版）
2.4.1 目标 & 问题
Question

「整体数据记录靠不靠谱？主要出问题的类型是什么？具体是哪几份合同有问题？」

这个 widget 需要在同一行同时展示：

左：整体记录是否完整（Good vs Bad）

中：问题类型分布（缺日期、数量异常等）

右：具体有问题的合同/产品列表

并且：

问题类型分布图上直接标出问题类型名称和数量/比例；

不依赖 hover / tooltip 才能读懂；

每个扇区都有一条「连线」拉到右侧的文字标签，整体阅读清晰。

2.4.2 数据与规则
Universe / 统计对象

推荐用 Contract-Product 级别（每条合同-产品记录一条）。

问题判定规则（示例，可扩展）

一条记录，如果满足以下任意一项，即视为“不完整 / 有问题”：

状态为已发货/已完成，但 shipping_date 为空

shipping_date < signing_date

actual_quantity_shipped > actual_quantity_produced

时间顺序明显异常（如生产结束早于生产开始）

其它业务定义的异常（可在后端扩展）

每条 Bad 记录可以打上一个或多个 问题类型标签，如：

缺少发货日期

数量不一致（发货数量 > 生产数量）

时间顺序异常

其它

2.4.3 布局结构（关键更新）
在桌面端，一个横向三栏布局：

[ 左：整体饼图 ] [ 中：问题类型分布饼图 + 文字标注 ] [ 右：问题合同列表 ]

在较小屏幕，可以降级为上下，但桌面端优先按三栏来设计。

左侧：整体记录完整度饼图（Good vs Bad）
一个简单的 donut / pie：

扇区 A：记录完整（Good）

扇区 B：记录有问题（Bad）

中心文字示例：

第一行：92%

第二行（小字）：记录信息完整

图下小字说明：

「统计口径：以合同 × 产品为一条记录；只要有一个字段存在问题即计为需要补充。」

Hover 在这里可以有，但不是必须；关键信息已经在数值和文字里给出。

中间：问题类型分布饼图 + 靠边文字标注（无 hover 依赖）
一个饼图（或环形图），每个扇区代表一种问题类型，例如：

缺少发货日期

数量不一致

时间顺序异常

其它

不依赖 tooltip：
每个扇区有一条细线连到饼图右侧的文字标注区域，每行标注包括：

彩色小圆点（对应扇区颜色）

问题类型名称，例如 缺少发货日期

问题条数 + 大致占比，例如 8 条 · 40%

示例如下（文字区域）：

● 缺少发货日期 —— 8 条 · 40%

● 数量不一致 —— 5 条 · 25%

● 时间顺序异常 —— 4 条 · 20%

● 其它 —— 3 条 · 15%

若屏幕宽度足够，中间这块可以宽一点，让饼图 + 右侧标注整体居中对齐；

扇区内部可以只画颜色，不必写文本，避免拥挤，所有文字都放在右侧标注中。

右侧：问题合同列表（与图并排）
重点更新：列表要放在图的右边，不是下面。

列表是一个紧凑的表格或「卡片列表」，每行一条有问题的记录。

建议列：

合同号

品牌 / 产品（可合并写成一列，例如：PowerGums · Gummies）

问题类型简写（与中间饼图类型一致，如 缺少发货日期）

最近更新时间（可用短格式，如 2024-10-15）

行数控制：

默认展示前 5–10 条（按最近更新时间或严重程度排序），避免过长；

底部可以有一行「查看更多」链接，但 Demo 阶段可以先不做跳转。

与中间问题类型饼图的互动（可选但推荐）：

点击中间部分的某个问题类型文字标注（如「数量不一致」），右侧列表只显示该问题类型的记录；

再次点击则取消过滤，恢复全部问题记录。

列表上方可加一个简短标题，例如：
有问题的合同（示例） 或 需要回查的记录。

2.4.4 与 KPI & 交互联动
与顶部 KPI「数据记录需补充」联动

点击 P1-A 中的「数据记录需补充」卡片时：

页面滚动到 P1-D Widget；

默认高亮 P1-D 卡片边框；

右侧列表显示全部问题记录（按严重程度或最近更新时间排序）。

与中间问题类型饼图联动

点击中间饼图上任一类型的「文字标注行」（不是扇区本身也可以）：

右侧列表过滤为该类型问题；

文字标注行本身高亮（例如背景浅色或边框）。

与 Good/Bad 饼图联动（可简单处理）

点击左侧整体饼图中「需要补充」扇区 / 中心文字：

中间饼图 & 右侧列表恢复显示所有问题类型，不附加额外过滤；

相当于“取消类型过滤，回到全部问题”。

2.4.5 说明文案（建议）
卡片底部统一一条说明，不依赖 hover：

「左侧显示整体记录是否完整，中间显示主要问题类型的占比，右侧列出部分有问题的合同，用于帮助快速回查并补全信息。本页面为示例数据，真实环境会接入 Ora 实际系统记录。」

3. PART 2 – Process Lead Time / 内部流程周期（与 v7 一致）
本部分未改动逻辑，仅列关键点，方便工程与产品统一。

3.1 Widget P0 – Contract Entry Latency / 合同录入延迟
指标：entry_lag_days = contract_entry_date - signing_date

配置：contract_entry_sla_days（例如 3 天）

KPI：

中位录入延迟天数

大于 contract_entry_sla_days 的合同占比

展示：

顶部 Warning Banner：例如「约 15% 的合同在签约 3 天后才录入系统」

点击「查看明细」可打开侧栏列表。

3.2 Widget P1 – Order-to-Ship Lead Time Waterfall
范围：status = 'completed'

指标：

每阶段平均耗时 avg_stage_k_days（1–5）

总周期中位数 median_total_lead_time_days

可选：P90_total_lead_time_days

展示：

横向或纵向瀑布图，显示各阶段平均天数；

顶部大号数字：整体中位周期：42 天；

柱顶显示 X 天 文本。

3.3 Widget P2 – Stage SLA Breaches / 各阶段超出目标占比
指标：

breach_rate_k = sum(breach_k) / count(valid_stage_k)

avg_excess_days_k = avg(excess_days_k | breach_k=1)

展示：

柱状图：X 为阶段 1–5，Y 为超出比例；

颜色阈值：<20% 绿，20–50% 橙，>50% 红；

右侧文本列出 Top 2 瓶颈阶段。

3.4 Widget P3 – Plan Adherence by Line / 各产线按时交付
指标：

delay_days = actual_date - planned_date

on_time_flag = delay_days <= plan_delay_tolerance_days

按产线聚合：按时率 & 平均推迟天数

展示：

柱（按时比例） + 折线（平均延迟天数）混合图。

3.5 Widget P4 – Material Readiness vs Production / 物料准备度
指标：

lag_days = production_start_date - materials_ready_date

分类：

Waiting（健康缓冲）：lag_days >= waiting_threshold_days

JIT：-jit_tolerance_days <= lag_days <= jit_tolerance_days

Risky：lag_days < -jit_tolerance_days

展示：

Doughnut 图：三类比例

右侧列表列出风险批次。

3.6 Widget G1 – Factory Growth & Value Uplift / 工厂产出与效率提升
按季度聚合：

total_units_shipped

growth_qoq / growth_yoy

avg_lead_time 与基准期比较，例如 -3d vs baseline

展示（推荐双轴）：

折线 + 面积：季度出货总量

柱状图（第二轴）：平均交付天数或相对基准变化

右侧 2–3 个 KPI 卡片：

本季度出货总量 + QoQ

平均交付时间 + vs baseline

4. PART 3 – Client & Opportunity Radar / 客户与机会雷达（与 v7 一致）
聚焦：不看金额，只看「订单量 / 频次 / 排产占比 / 剂型覆盖」来找机会和风险。

4.1 Widget 3A – Dormant & Cooling Clients / 客户流失与降温
数据：按品牌 × 季度聚合，contracts_q、volume_q

定义：

「历史活跃」：过去 4 季中至少 2 季 contracts_q ≥ 2

Dormant：历史活跃，但当前季 contracts_q = 0

Cooling：最近两季量/频次明显下降（例如 <60% & 频次减半）

展示：

双柱图：前一周期 vs 当前周期

表格：品牌 / 状态（Dormant/ Cooling） / Prev → Curr 文本

4.2 Widget 3B – Cooling Key Clients (Detail)
过滤：仅看体量 Top 30% 大客户中的 Cooling

展示：详细列表 + 趋势比例。

4.3 Widget 3C – Future Capacity Concentration (Next 90d)
数据：未来 90 天按品牌汇总排产量

指标：各品牌占比；Top3 占比

展示：

横向条形图

文案：如「当前前三大客户占用约 72% 的排产产能，集中度偏高」。

4.4 Widget 3D – Line-Format White Space Matrix / 剂型白地
行：品牌；列：产线/剂型

着色：

深色：Strong（持续大量下单）

浅色：Light（偶尔下单）

空白/虚框：Gap（从未下单）

目的：一眼看到“某品牌只做软糖，我们可以建议尝试粉剂线”。

4.5 Widget 3E – Seasonality Gap / 旺季缺口
按品牌 × 季度：

avg_volume_historical：历史同季度均量（排除当年）

current_volume_Qx：今年该季度量

触发条件：

若 avg_volume_historical 大于某阈值（旺季）

且 current_volume_Qx 远低于历史（例如 <20%）

展示：

表格列出「按理说该下单但还没来」的品牌。

5. Technical Notes & Constraints / 技术备注与约束
5.1 Configurations / 可配置参数
建议做成配置或数据库表：

阶段目标天数：stage_1_sla_days … stage_5_sla_days

合同录入 SLA：contract_entry_sla_days

Blockers：

payment_grace_days

materials_buffer_days

silent_threshold_days

僵尸 / 滞留阈值：

contract_zombie_days

inventory_stuck_days

Cooling 判断阈值：

量比例，例如 0.6

频次比例，例如 0.5

Seasonality 阈值：

peak_threshold

gap_tolerance_ratio

5.2 Pre-aggregation / 预聚合建议
为保证性能，可：

夜间批处理 / 物化视图，预计算：

各阶段耗时 & 延迟天数

品牌 × 季度聚合数据

工厂季度出货量 & lead time 基准

未来 90 天排产容量

5.3 Scope Control / 范围控制（重要）
本版本不实现 To-do List、任务指派、打勾完成等功能。

看板定位为「监控与洞察工具」，真正的行动（打电话、改排产、补数据）发生在业务流程中。

后续若引入任务模块，将另起产品需求。

